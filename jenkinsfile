pipeline { 
    
    stages {
        
        stage ('Git-Checkout') {
            
            steps {
                
                git branch: 'main',
                credentialsId: 'github-token',
                url: 'https://github.com/abhishekishor/jenkins-maven-sonar-nexus-tomcat-docker.git'
                
            }
            
        }
        
        stage ('Maven Build') {
            
            steps {
                
                sh 'mvn clean package'
                
            }
            
            post {
                
                success {
                    
                    archiveArtifacts artifacts: '*/**.jar'
                    
                }
            
            }
        
        }
        
        stage ('docker-build') {
            
            steps {
                
                script {
                    
                    sh "docker build -t abhishekkishor1/java-web-app:${env.BUILD_NUMBER} ."
                    
                }
                
            }
            
        }
        
        stage ('Docker Login & Push') {
            
            steps {
                
                script {
                    
                    withCredentials([string(credentialsId: 'dockerhub-pwd', variable: 'dockerhublogin')]) {
                        
                        sh 'docker login -u abhishekkishor1 -p ${dockerhublogin}'
                        
                    }
                    
                }
                
            }
            
            post {
                
                success {
                    
                    sh "docker push abhishekkishor1/java-web-app:${env.BUILD_NUMBER}"
                    
                }
                
            }
        }
        
    }
}
